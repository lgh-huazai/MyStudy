# 内存缓存

我们可以使用**内存缓存**来解决服务器端缓存遇到的问题。

内存缓存是服务器端缓存的一种手法。

1、定义

**把数据存放到服务器应用程序的内存中**。

内存缓存中保存的是一系列的键值对（key-value），就像Dictionary一样。

我们的程序跟缓存是在同一个进程当中。程序关闭，相应的内存缓存也一并被销毁。

2、注意

多个网站是运行在不同的进程中的，因此不同的网站的内存缓存是互不干扰的，网站重启后，内存缓存中的所有数据就被清空了

3、如何使用？

- 注入内存缓存相关服务：builder.services.AddMemoryCache()
- 注入IMemoryCache接口

相关方法:

GetOrCreateAsync()，推荐使用

- 从缓存获取数据，若没有，则从数据源获取数据并把数据放进内存当中，反之则从缓存取出数据。

# 缓存过期时间策略

由于缓存会有数据不一致的问题。

解决办法：

1、重启程序。想当于重启了进程，那么缓存就从头再来。代价太大！

2、在数据改变的时候调用Remove或者Set来删除或者修改缓存。及时！

3、设置过期时间。

两种过期时间策略：

- **绝对过期策略**，就是设置多少秒缓存就过期
- **滑动过期策略**，在缓存没过期之前，如果被访问，缓存自动续命一段时间

注意：

两种过期时间策略可以重复使用，但是绝对过期时间策略的缓存时间要比滑动时间策略的时间要长才行！为什么？因为如果比它设置的短的话，不管你怎么滑动让它续命，都会被杀死（因为你的绝对过期时间设置的太短，还没来得及执行滑动续命，绝对过期时间就到了）
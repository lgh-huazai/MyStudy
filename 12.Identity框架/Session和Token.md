## Session

以前的网站，由于http协议是无状态的，是怎么知道这次请求是谁呢？

用户登录后，在服务器会生成一个sessionid与这个用户信息，并把这个对应关系保存起来（存在内存中），

并把这个sessionid返回给浏览器，并存在cookie中，下一次请求的时候带上这个sessionid，这样就知道这次

请求是谁了。

1、什么是无状态请求？

也就是第一次http请求和第二次http请求没有任何关系。

2、cookie是指什么？

存储在用户终端上的数据。一般分为两种：

- 会话cookie：一般存在浏览器进程的内存中，浏览器关闭cookie就失效
- 本地磁盘cookie：存在本地磁盘中，永久有效

## Session缺点

对于分布式集群的环境，session就有点力不从心了。

但是，也有解决方案：就是部署一台中心状态服务器（Redis、Memcached），客户端的请求读到这台中心

状态服务器拿状态。

其实，现在的web系统已不太建议这种方案了。为什么？

1、性能问题（从内存读取的速度肯定快于跨服务器去中心服务器读取）

2、有的客户端保存cookie不太方便（app，小程序）

## JWT（Json Web Token）

JWT把登录信息保存在客户端。

为了防止客户端数据造假，保存在客户端的令牌经过签名处理，签名的秘钥只有服务器端才知道，

**每次服务器收到客户端提交过来的令牌都要检查一下签名**。

token有三部分组成：

1、头部header（签名算法，比如SHA256）

2、负载payload（用户信息，比如username）

3、签名signature（签名算法：header + payload + 服务器才知道的秘钥）

服务器拿到token后，先用秘钥+token里的header+token里的payload经过签名算法生成一个签名，

然后再跟客户端传过来的签名进行比对，若错误则报错，若一致则使用token里面的用户信息。

优点：

1、状态保存在客户端，天然适合分布式系统

2、签名机制保证了客户端token不会数据造假

3、性能更高（纯内存字符串操作，不需要与第三方服务器通讯）

## 如何生成token

在项目中安装以下nuget包：

```
System.IdentityModel.Tokens.JWT
```

![](..\99.截图\18.png)